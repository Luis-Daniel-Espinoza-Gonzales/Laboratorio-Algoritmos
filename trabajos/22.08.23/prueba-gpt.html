<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <link rel="stylesheet" href="/22.08.23/style.css">
    <script>
        $(document).ready(function () {
            $.ajax({
                url: 'https://api.themoviedb.org/3/genre/movie/list?api_key=0e72c32f18442a694f54726ee7d10a33',
                type: 'GET',
                dataType: 'json',
                success: function (data_01) {
                    var genres = data_01.genres;
                    var buttonsHTML = genres.map(function (genre) {
                        return '<input class="btn_genre" id="' + genre.id + '" type="button" value="' + genre.name + '"/>';
                    }).join('');
                    $('#result_00').html(buttonsHTML);
                    
                    $('.btn_genre').click(function () {
                        var genero = $(this).attr('id');
                        cargarPeliculas(genero, 1);
                    });
                }
            });

            function cargarPeliculas(genero, pagina) {
                $.ajax({
                    url: "https://api.themoviedb.org/3/discover/movie?api_key=0e72c32f18442a694f54726ee7d10a33&with_genres=" + genero + "&page=" + pagina,
                    type: 'GET',
                    dataType: 'json',
                    success: function (data_02) {
                        var str_03 = '';
                        var results = data_02.results;

                        results.forEach(function (result) {
                            str_03 += '<div class="content-img">';
                            str_03 += '<img src="https://image.tmdb.org/t/p/original' + result.poster_path + '" height="350px" width="225px">';
                            str_03 += '<div class="original_title"><h4>' + result.original_title + '</h4></div>';
                            str_03 += '<div class="overview"><p>' + result.overview + '</p></div>';
                            str_03 += '</div>';
                        });

                        $('#result_01').html(str_03);
                        crearBotonesPaginacion(data_02.total_pages, pagina, genero);
                    }
                });
            }

            function crearBotonesPaginacion(totalPages, paginaActual, genero) {
                var numBotones = 8;
                var str_04 = '<button class="btn_page" id="anterior">Anterior</button>';
                for (var i = 1; i <= numBotones; i++) {
                    var pagina = paginaActual - Math.floor(numBotones / 2) + i;
                    if (pagina >= 1 && pagina <= totalPages) {
                        str_04 += '<button class="btn_page" id="' + pagina + '">' + pagina + '</button>';
                    }
                }
                str_04 += '<button class="btn_page" id="siguiente">Siguiente</button>';

                $('#result_02').html(str_04);

                $('.btn_page').click(function () {
                    var id = $(this).attr('id');
                    if (id === 'anterior') {
                        paginaActual--;
                    } else if (id === 'siguiente') {
                        paginaActual++;
                    } else {
                        paginaActual = parseInt(id);
                    }

                    cargarPeliculas(genero, paginaActual);
                });
            }
        });
    </script>
</head>

<body>
    <div id="result_00"></div>
    <div id="result_01"></div>
    <div id="result_02"></div>
</body>

</html>
